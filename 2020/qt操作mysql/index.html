<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="mentir.">
  
  
  
  <link rel="prev" href="https://metrillin.github.io/2020/libcurl%E7%BC%96%E8%AF%91/" />
  <link rel="next" href="https://metrillin.github.io/2020/const%E8%AF%A6%E8%A7%A3%E4%B8%8Econstexpr/" />
  <link rel="canonical" href="https://metrillin.github.io/2020/qt%E6%93%8D%E4%BD%9Cmysql/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           Ｑｔ操作mysql | 保持热爱
       
  </title>
  <meta name="title" content="Ｑｔ操作mysql | 保持热爱">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https://metrillin.github.io/"
    },
    "articleSection" : "posts",
    "name" : "Ｑｔ操作mysql",
    "headline" : "Ｑｔ操作mysql",
    "description" : "[TOC]
1. 基本操作 1.1 添加模块 Qt数据库模块是独立模块，需要像core，gui一样在.pro文件中添加该模块
QT+=sql  1.2 基本操作 获取可用连接 首先查看qt下支持的连接名
qDebug() &lt;&lt; QSqlDatabase::drivers();  输出如下 (&quot;QSQLITE&quot;, &quot;QMYSQL&quot;, &quot;QMYSQL3&quot;, &quot;QPSQL&quot;, &quot;QPSQL7&quot;)
建立连接 使用上一步获取到的连接名作为addDatabase的第一个参数
QSqlDatabase db = QSqlDatabase::addDatabase(&quot;QMYSQL&quot;);  这样我们就获取到mysql的句柄了 接下来是mysql的基本操作
db.setHostName(&quot;localhost&quot;); // 假定数据库在本机 db.setDatabaseName(&quot;student&quot;); // 打开数据库名 db.setUserName(&quot;root&quot;); // 数据库用户名 db.setPassword(&quot;123456&quot;); // 数据库密码  设置完之后调用open()打开mysql数据库,完整代码如下
QSqlDatabase db = QSqlDatabase::addDatabase(&quot;QMYSQL&quot;); db.setHostName(&quot;localhost&quot;); // 假定数据库在本机 db.setDatabaseName(&quot;server&quot;); // 打开数据库名 db.setUserName(&quot;root&quot;); // 数据库用户名 db.setPassword(&quot;123456&quot;); // 数据库密码 if (!db.open()) { qDebug() &lt;&lt; &quot;Failed to connect to root mysql!",
    "inLanguage" : "en-us",
    "author" : "mentir.",
    "creator" : "mentir.",
    "publisher": "mentir.",
    "accountablePerson" : "mentir.",
    "copyrightHolder" : "mentir.",
    "copyrightYear" : "2020",
    "datePublished": "2020-12-07 18:12:25 &#43;0800 PST",
    "dateModified" : "2020-12-07 18:12:25 &#43;0800 PST",
    "url" : "https://metrillin.github.io/2020/qt%E6%93%8D%E4%BD%9Cmysql/",
    "wordCount" : "182",
    "keywords" : [ "Qt", "保持热爱"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://metrillin.github.io/">保持热爱</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">博客</a>
                
                <a class="menu-item" href="/categories/" title="">分类</a>
                
                <a class="menu-item" href="/tags/" title="">标签</a>
                
                <a class="menu-item" href="/about/" title="">关于</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://metrillin.github.io/">保持热爱</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">博客</a>
                
                <a class="menu-item" href="/categories/" title="">分类</a>
                
                <a class="menu-item" href="/tags/" title="">标签</a>
                
                <a class="menu-item" href="/about/" title="">关于</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Ｑｔ操作mysql</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://metrillin.github.io/" rel="author">mentir.</a> with ♥ 
                <span class="post-time">
                on <time datetime=2020-12-07 itemprop="datePublished">December 7, 2020</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://metrillin.github.io/categories/qt/"> Qt </a>
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          

<p>[TOC]</p>

<h1 id="1-基本操作">1. 基本操作</h1>

<h2 id="1-1-添加模块">1.1 添加模块</h2>

<p>Qt数据库模块是独立模块，需要像core，gui一样在.pro文件中添加该模块</p>

<pre><code class="language-c">QT+=sql
</code></pre>

<h1 id="1-2-基本操作">1.2 基本操作</h1>

<h2 id="获取可用连接">获取可用连接</h2>

<p>首先查看qt下支持的连接名</p>

<pre><code class="language-c">qDebug() &lt;&lt; QSqlDatabase::drivers();
</code></pre>

<p>输出如下
<code>(&quot;QSQLITE&quot;, &quot;QMYSQL&quot;, &quot;QMYSQL3&quot;, &quot;QPSQL&quot;, &quot;QPSQL7&quot;)</code></p>

<h2 id="建立连接">建立连接</h2>

<p>使用上一步获取到的连接名作为<strong><em>addDatabase</em></strong>的第一个参数</p>

<pre><code class="language-c">QSqlDatabase db = QSqlDatabase::addDatabase(&quot;QMYSQL&quot;);
</code></pre>

<p>这样我们就获取到mysql的句柄了
接下来是mysql的基本操作</p>

<pre><code class="language-c">    db.setHostName(&quot;localhost&quot;);  // 假定数据库在本机
    db.setDatabaseName(&quot;student&quot;); // 打开数据库名
    db.setUserName(&quot;root&quot;);  // 数据库用户名
    db.setPassword(&quot;123456&quot;);  // 数据库密码
</code></pre>

<p>设置完之后调用open()打开mysql数据库,完整代码如下</p>

<pre><code class="language-c">    QSqlDatabase db = QSqlDatabase::addDatabase(&quot;QMYSQL&quot;);
    db.setHostName(&quot;localhost&quot;);  // 假定数据库在本机
    db.setDatabaseName(&quot;server&quot;); // 打开数据库名
    db.setUserName(&quot;root&quot;);  // 数据库用户名
    db.setPassword(&quot;123456&quot;);  // 数据库密码
    if (!db.open())
    {
        qDebug() &lt;&lt; &quot;Failed to connect to root mysql!&quot;;
    }
    else
    {
        qDebug() &lt;&lt; &quot;open success!&quot;;
    }
    
</code></pre>

<h2 id="增删改查">增删改查</h2>

<p>数据库操作无非增删改查，基于我们获取到的句柄，我们可以对数据库进行操作。</p>

<p>QSqlQuery类提供了一种执行和操作SQL语句的方法</p>

<pre><code class="language-c">QSqlQuery sqlquery(db);
</code></pre>

<p>插入数据Demo</p>

<pre><code class="language-c">    //插入新数据
    QSqlQuery sql_query(db);
    sql_query.prepare(&quot;insert into stu(name,stuID,sex,score) values('stu2','123123','1',''70)&quot;);
    if(!sql_query.exec())
    {
       qDebug()&lt;&lt;sql_query.lastError();
    }
    else
    {
        qDebug()&lt;&lt;&quot;insert Success...&quot;;
    }
</code></pre>

<p>查询Demo</p>

<pre><code class="language-c">    QSqlQuery sql_query(db);
    sql_query.prepare(&quot;select * from stu&quot;);
    if(!sql_query.exec())
    {
       qDebug()&lt;&lt;sql_query.lastError();
    }
    else
    {
       while(sql_query.next())
        {
           QString name = sql_query.value(&quot;name&quot;).toString();
           QString id = sql_query.value(&quot;stuID&quot;).toString();
           QString sex = sql_query.value(&quot;sex&quot;).toString();
            QString score = sql_query.value(&quot;score&quot;).toString();
            qDebug()&lt;&lt;QString(&quot;Name:%1     ID:%2    sex:%3    score:%4&quot;).arg(name).arg(id).arg(sex).arg(score);
        }
    }
</code></pre>

<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="https://gitee.com/linMentri/mapdepot/raw/master/1600329730_20200403142349526_31331.png" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure></p>

<h1 id="1-3-批量使用">1.3 批量使用</h1>

<hr />

<h1 id="2-driver-not-loaded错误处理">2. driver not loaded错误处理</h1>

<h2 id="问题排查">问题排查</h2>

<p>第一次使用Qtmysql的库时容易看到qDebug有如下打印</p>

<pre><code>QSqlDatabase: QMYSQL driver not loaded
QSqlDatabase: available drivers: QSQLITE QMYSQL QMYSQL3 QPSQL QPSQL7
</code></pre>

<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="https://gitee.com/linMentri/mapdepot/raw/master/1600329726_20200402173143995_5048.png" alt="clipboard" class="lazyload"><figcaption class="image-caption">clipboard</figcaption></figure>
查看本机mysql，发现mysqlClient库安装正常</p>

<pre><code>ls /usr/lib/x86_64-linux-gnu/libmysql* -lsd
</code></pre>

<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="https://gitee.com/linMentri/mapdepot/raw/master/1600329727_20200403101104397_31787.png" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure>
查看Qt数据组件sql是否正常
1）进入到Qt的安装目录下，进入对应编译器文件夹中，楼主的文件夹是
<figure><img src="/images/ring.svg" data-sizes="auto" data-src="https://gitee.com/linMentri/mapdepot/raw/master/1600329728_20200403101412861_21234.png" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure>
查看<strong>libqsqlmysql.so</strong>文件链接是否正常</p>

<pre><code>ldd libqsqlmysql.so
</code></pre>

<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="https://gitee.com/linMentri/mapdepot/raw/master/1600329728_20200403101545125_14714.png" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure>
结果发现Qt中mysql库链接的是18的版本，而当前环境没有该版本的mysql库</p>

<h2 id="解决方案">解决方案</h2>

<h3 id="1-下载对应版本的libsqlclient">1.下载对应版本的libsqlclient</h3>

<p>这个方式比较方便，适合绝大多数场景
* 下载地址： <a href="https://launchpad.net/ubuntu/xenial/amd64/libmysqlclient18/5.6.25-0ubuntu1" rel="nofollow noreferrer" target="_blank">https://launchpad.net/ubuntu/xenial/amd64/libmysqlclient18/5.6.25-0ubuntu1</a>
* 下载 libmysqlclient18_5.6.25-0ubuntu1_amd64.deb，然后 dpkg -i libmysqlclient18_5.6.25-0ubuntu1_amd64.deb 即可。</p>

<h3 id="2-重新编译qt中的libqsqlmysql库">2.重新编译Qt中的libqsqlmysql库</h3>

<p>进入安装时下载的Qt源码，在对应版本的SRC文件夹下，对该库的源码进行重新编译
<figure><img src="/images/ring.svg" data-sizes="auto" data-src="https://gitee.com/linMentri/mapdepot/raw/master/1600329729_20200403102316916_2297.png" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure>
最后将编译好的libqsqlmysql.so库放回原先的位置。</p>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>mentir. </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://metrillin.github.io/2020/qt%E6%93%8D%E4%BD%9Cmysql/>https://metrillin.github.io/2020/qt%E6%93%8D%E4%BD%9Cmysql/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://metrillin.github.io/tags/qt/">
                    #Qt</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://metrillin.github.io/">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://metrillin.github.io/2020/libcurl%E7%BC%96%E8%AF%91/" class="prev" rel="prev" title="LibCurl编译"><i class="iconfont icon-left"></i>&nbsp;LibCurl编译</a>
         
        
        <a href="https://metrillin.github.io/2020/const%E8%AF%A6%E8%A7%A3%E4%B8%8Econstexpr/" class="next" rel="next" title="Const详解与constexpr">Const详解与constexpr&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2018 - 2021</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://metrillin.github.io/">mentir.</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    
  



     </div>
  </body>
</html>
